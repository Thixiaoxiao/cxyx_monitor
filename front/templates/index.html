<!doctype html>
<html>
<head>
    <!doctype html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport"
              content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>CXYX监控平台</title>
        <link type="text/css" href="../static/css/public.css" rel="stylesheet">
        <link type="text/css" href="../static/css/icon.css" rel="stylesheet">
        <link type="text/css" href="../static/css/index.css" rel="stylesheet">
        <script type="text/javascript">
            document.documentElement.style.fontSize = document.documentElement.clientWidth / 768 * 100 + 'px';
        </script>

        <script src="../static/js/echarts.min.js"></script>
    </head>
    <style>
        .abc {

        }
        @-webkit-keyframes widthMove1 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("today").get("value") }}%; }
             }
        @-webkit-keyframes widthMove2 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("yest").get("value") }}%; }
             }
        @-webkit-keyframes widthMove3 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("qst").get("value") }}%; }
             }
        @-webkit-keyframes widthMove4 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("kv4").get("value") }}%; }
             }
        @-webkit-keyframes widthMove5 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("kv5").get("value") }}%; }
             }
        @-webkit-keyframes widthMove6 {
             0% {width:0%; }
             100% { width:{{ sucbili.get("kv6").get("value") }}%; }
             }

    </style>

<body>
<div class="bg">
    <div class="title">CXYX 数据监控台</div>
    <div class="leftMain">
        <div class="leftMain_top">
            <div class="leftMain_topIn">
                <ul>
                    <li>
                        <div class="liIn">
                            <h3>等待执行</h3>
                            <p class="shu"><span class="shu1"
                                                 id="wait">0</span><i>个</i></p>
                            <div class="zi"><span
                                    class="span1">已执行：否</span><span>已添加：是</span>
                            </div>
                            <span class="border_bg_leftTop"></span>
                            <span class="border_bg_rightTop"></span>
                            <span class="border_bg_leftBottom"></span>
                            <span class="border_bg_rightBottom"></span>
                        </div>
                    </li>
                    <li>
                        <div class="liIn">
                            <h3>已执行</h3>
                            <p class="shu"><span class="shu2"
                                                 id="after">0</span><i>个</i>
                            </p>
                            <div class="zi"><span
                                    class="span1">已执行：是</span><span>已添加：是</span>
                            </div>
                            <span class="border_bg_leftTop"></span>
                            <span class="border_bg_rightTop"></span>
                            <span class="border_bg_leftBottom"></span>
                            <span class="border_bg_rightBottom"></span>
                        </div>
                    </li>
                    <li>
                        <div class="liIn">
                            <h3>成功执行</h3>
                            <p class="shu"><span class="shu3"
                                                 id="success">0</span><i>个</i>
                            </p>
                            <div class="zi"><span
                                    class="span1">已执行：是</span><span>已添加：是</span>
                            </div>
                            <span class="border_bg_leftTop"></span>
                            <span class="border_bg_rightTop"></span>
                            <span class="border_bg_leftBottom"></span>
                            <span class="border_bg_rightBottom"></span>
                        </div>
                    </li>
                    <li>
                        <div class="liIn">
                            <h3>失败执行</h3>
                            <p class="shu"><span class="shu4"
                                                 id="fail">0</span><i>个</i></p>
                            <div class="zi"><span
                                    class="span1">已执行：是</span><span>已添加：是</span>
                            </div>
                            <span class="border_bg_leftTop"></span>
                            <span class="border_bg_rightTop"></span>
                            <span class="border_bg_leftBottom"></span>
                            <span class="border_bg_rightBottom"></span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="leftMain_middle">
            <div class="leftMain_middle_left">
                <div class="leftMain_middle_leftIn">
                    <h3>最近十天任务执行量</h3>
                    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
                    <div class="biaoge" style="width:100%; height:25vh"
                         id="chartmain"></div>
                    <span class="border_bg_leftTop"></span>
                    <span class="border_bg_rightTop"></span>
                    <span class="border_bg_leftBottom"></span>
                    <span class="border_bg_rightBottom"></span>
                </div>
            </div>
            <div class="leftMain_middle_right">
                <div class="leftMain_middle_rightIn">
                    <h3>最近五天成功比例</h3>
                    <div class="biaoge biaoge_pai"
                         style="width:100%; height:25vh">
                        <div class="biaoge_paiIn">
                            <ul>
                                <li>
                                    <div class="liIn">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("today").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("today").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("today").get("value") }}%</p>
                                    </div>
                                </li>

                                <li>
                                    <div class="liIn liIn2">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("yest").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("yest").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("yest").get("value") }}%</p>
                                    </div>
                                </li>
                                <li>
                                    <div class="liIn liIn3">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("qst").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("qst").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("qst").get("value") }}%</p>
                                    </div>
                                </li>
                                <li>
                                    <div class="liIn liIn4">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("kv4").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("kv4").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("kv4").get("value") }}%</p>
                                    </div>
                                </li>
                                <li>
                                    <div class="liIn liIn5">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("kv5").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("kv5").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("kv5").get("value") }}%</p>
                                    </div>
                                </li>
                                <li>
                                    <div class="liIn liIn6">
                                        <div class="liIn_left"><span
                                                class="bot"></span><span
                                                class="zi">{{ sucbili.get("kv6").get("name") }}</span></div>
                                        <div class="liIn_line">
                                            <div class="line_lineIn"
                                                 style="width:{{ sucbili.get("kv6").get("value") }}%;"></div>
                                        </div>
                                        <p class="num">{{ sucbili.get("kv6").get("value") }}%</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <span class="border_bg_leftTop"></span>
                    <span class="border_bg_rightTop"></span>
                    <span class="border_bg_leftBottom"></span>
                    <span class="border_bg_rightBottom"></span>
                </div>
            </div>
        </div>
        <div class="leftMain_middle">
            <div class="leftMain_middle_left">
                <div class="leftMain_middle_leftIn">
                    <h3>最近12小时内任务处理速度</h3>
                    <div class="biaoge" style="width:100%; height:25vh"
                         id="chartmain_zhe"></div>
                    <span class="border_bg_leftTop"></span>
                    <span class="border_bg_rightTop"></span>
                    <span class="border_bg_leftBottom"></span>
                    <span class="border_bg_rightBottom"></span>
                </div>
            </div>
            <div class="leftMain_middle_right">
                <div class="leftMain_middle_rightIn">
                    <h3>任务成败统计</h3>
                    <div class="biaoge biaoge_bi"
                         style="width:100%; height:25vh">
                        <ul>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu1">{{ count.get("success").get("today") }}</p>
                                    <p class="zi">今日成功数量</p>
                                </div>
                            </li>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu2">{{ count.get("success").get("week") }}</p>
                                    <p class="zi">近一周成功数量</p>
                                </div>
                            </li>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu3">{{ count.get("success").get("month") }}</p>
                                    <p class="zi">近一月成功数量</p>
                                </div>
                            </li>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu4">{{ count.get("fail").get("today") }}</p>
                                    <p class="zi">今日失败数量</p>
                                </div>
                            </li>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu5">{{ count.get("fail").get("week") }}</p>
                                    <p class="zi">近一周失败数量</p>
                                </div>
                            </li>
                            <li>
                                <div class="liIn">
                                    <p class="shu shu6">{{ count.get("fail").get("month") }}</p>
                                    <p class="zi">近一月失败数量</p>
                                </div>
                            </li>
                        </ul>

                    </div>
                    <span class="border_bg_leftTop"></span>
                    <span class="border_bg_rightTop"></span>
                    <span class="border_bg_leftBottom"></span>
                    <span class="border_bg_rightBottom"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="rightMain">
        <div class="rightMain_top">
            <div class="rightMain_topIn">
                <h3>任务量统计</h3>
                <div class="biaoge" style="width:100%; height:30vh"
                     id="chartmain_bing"></div>
                <span class="border_bg_leftTop"></span>
                <span class="border_bg_rightTop"></span>
                <span class="border_bg_leftBottom"></span>
                <span class="border_bg_rightBottom"></span>
            </div>
        </div>
        <div class="rightMain_bottom">
            <div class="rightMain_bottomIn">
                <h3>最近任务展示</h3>
                <div class="biaoge biaoge_list"
                     style="width:100%; height:36vh">
                    <div class="biaoge_listIn">
                        <ul class="ul_title">
                            {% for item in table_key %}
                                <li>{{ item }}</li>
                            {%endfor%}
                        </ul>
                        <div class="ul_list">
                            <div class="ul_listIn">
                                {% for item in array %}
                                    <ul class="ul_con">

                                    <li>{{ item.get("funcname") }}</li>
                                    <li>{{ item.get("thred") }}</li>
                                    <li>{{ item.get("beforetime") }}</li>
                                    <li>{{ item.get("status") }}</li>
                                    <li>{{ item.get("time_need") }}</li>
                                </ul>
                                {%endfor%}


                            </div>
                        </div>
                    </div>

                </div>
                <span class="border_bg_leftTop"></span>
                <span class="border_bg_rightTop"></span>
                <span class="border_bg_leftBottom"></span>
                <span class="border_bg_rightBottom"></span>
            </div>
        </div>
    </div>
    <div style="clear:both;"></div>
</div>
<!--数字增长累加动画-->
<script src="../static/js/jquery-1.11.0.min.js"
        type="text/javascript"></script>
<script src="../static/js/jquery.numscroll.js" type="text/javascript"
        charset="utf-8"></script>
<script type="text/javascript">
    update_num();
    var int = self.setInterval("update_num()", 1000 * 3);
    var int = self.setInterval("reload_my()", 1000 * 60 * 5);
    function reload_my() {
        location.reload();
    }
    function update_num() {
        function randomColor() {
            return '#' + ('00000' + (Math.random() * 0x1000000 << 0).toString(16)).substr(-6);
        }

        $.ajax({
            url: "/totalCount", success: function (result) {
                $("#wait").html(result["wait"]);
                $("#wait").attr("data-num", result["wait"]);
                $("#wait").numScroll();

                $("#after").html(result["after"]);
                $("#after").attr("data-num", result["after"]);
                $("#after").numScroll();

                $("#success").html(result["success"]);
                $("#success").attr("data-num", result["success"]);
                $("#success").numScroll();

                $("#fail").html(result["fail"]);
                $("#fail").attr("data-num", result["fail"]);
                $("#fail").numScroll();

                option = {
                        title: {
                            text: '数据情况统计',
                            subtext: '',
                            left: 'right',
                            textStyle: {
                                color: '#fff',
                                fontSize: 12
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b} : {c} ({d}%)'
                        },
                        legend: {
                            // orient: 'vertical',
                            // top: 'middle',
                            type: 'scroll',
                            orient: 'vertical',
                            right: 10,
                            top: 40,
                            bottom: 20,
                            left: 'right',
                            data: ['success', 'fail', 'running', 'waiting'],
                            textStyle: {
                                color: '#fff',
                                fontSize: 12
                            }

                        },
                        grid: {
                            x: '-10%',
                            y: 40,
                            x2: 20,
                            y2: 20,
                        },
                        color: ['#09d0fb', '#f88cfb', '#95f8fe', '#f9f390', ],
                        series: [
                            {
                                type: 'pie',
                                radius: '65%',
                                center: ['50%', '50%'],
                                selectedMode: 'single',
                                data: [
                                    {value: result["success"], name: 'success',},
                                    {value: result["fail"], name: 'fail'},
                                    {value: result["before"]-result["after"], name: 'running'},
                                    {value: result["wait"], name: 'waiting'},

                                ],
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    };
                    //获取dom容器
                    var myChart = echarts.init(document.getElementById('chartmain_bing'));
                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
            }
        });
        $.ajax({
            url: "/bar", success: function (result) {
                var dataAxis = result['dataAxis'];
                var data = result['data'];
                var yMax = result['yMax'];
                var klll = result['_name'];
                var dataShadow = [];
                for (var i = 0; i < data.length; i++) {
                    dataShadow.push(yMax);
                }
                option = {
                    title: {
                        text: '',
                        subtext: ''
                    },
                    grid: {
                        x: 40,
                        y: 40,
                        x2: 20,
                        y2: 20,

                    },
                    xAxis: {
                        data: dataAxis,
                        axisLabel: {
                            /*inside: true,*/
                            interval: 0,
                            textStyle: {
                                color: '#fff',
                                fontSize: 12

                            }
                        },
                        axisTick: {
                            show: false,
                        },
                        axisLine: {
                            show: true,
                            symbol: ['none', 'arrow'],
                            symbolOffset: 12,
                            lineStyle: {
                                color: '#fff',
                            }
                        },
                        z: 10
                    },
                    yAxis: {
                        type: 'value',
                        name: klll,
                        axisLine: {
                            show: true,
                            symbol: ['none', 'arrow'],
                            symbolOffset: 12,
                            lineStyle: {
                                color: '#fff',
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            textStyle: {
                                color: '#fff',
                                fontSize: 12
                            }
                        }
                    },

                    dataZoom: [
                        {
                            type: 'inside'
                        }
                    ],
                    series: [
                        { // For shadow
                            type: 'bar',
                            itemStyle: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            barGap: '-100%',
                            barCategoryGap: '40%',
                            data: dataShadow,
                            animation: false
                        },
                        {
                            type: 'bar',
                            itemStyle: {
                                color: new echarts.graphic.LinearGradient(
                                    0, 0, 0, 1,
                                    [
                                        {offset: 0, color: '#0efdff'},
                                        {offset: 0.5, color: '#188df0'},
                                        {offset: 1, color: '#188df0'}
                                    ]
                                )
                            },
                            emphasis: {
                                itemStyle: {
                                    color: new echarts.graphic.LinearGradient(
                                        0, 0, 0, 1,
                                        [
                                            {offset: 0, color: '#2378f7'},
                                            {offset: 0.7, color: '#2378f7'},
                                            {offset: 1, color: '#0efdff'}
                                        ]
                                    )
                                }
                            },
                            data: data
                        }
                    ]
                };
                //获取dom容器
                var myChart = echarts.init(document.getElementById('chartmain'));
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            }
        });
        $.ajax({
            url: "/zhe", success: function (result) {
                var xaray = result['x'];
                var y_success = result['y_success'];
                var y_fail = result['y_fail'];
                option = {
                    title: {
                        text: ''
                    },
                    tooltip: {
                        trigger: 'axis',
                    },
                    legend: {
                        textStyle: {
                            color: '#fff',
                            fontSize: 12,
                        },
                        right: '10%',
                        data: ['success', 'fail']
                    },
                    grid: {
                        x: 40,
                        y: 40,
                        x2: 20,
                        y2: 20,
                    },
                    toolbox: {
                        feature: {
                            //saveAsImage: {}
                        }
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        axisLabel: {
                            /*inside: true,*/
                            interval: 0,
                            textStyle: {
                                color: '#fff',
                                fontSize: 12

                            }
                        },
                        axisTick: {
                            show: false,
                        },
                        axisLine: {
                            show: true,
                            symbol: ['none', 'arrow'],
                            symbolOffset: 12,
                            lineStyle: {
                                color: '#fff',
                            }
                        },
                        data: xaray
                    },
                    yAxis: {
                        type: 'value',

                        axisLine: {
                            show: true,
                            {#symbol: ['none', 'arrow'],#}
                            symbolOffset: 12,
                            lineStyle: {
                                color: '#fff',
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            textStyle: {
                                color: '#fff',
                                fontSize: 12
                            }
                        }
                    },
                    series: [
                        {
                            name: 'success',
                            type: 'line',
                            stack: '总量',
                            data: y_success,
                            itemStyle: {
                                normal: {
                                    color: "#0efdff",//折线点的颜色
                                    lineStyle: {
                                        color: randomColor(),//折线的颜色
                                        width: 2,
                                    }
                                },
                            }
                        },
                        {
                            name: 'fail',
                            type: 'line',
                            stack: '总量',
                            data: y_fail,
                            itemStyle: {
                                normal: {
                                    color: "#3ef24f",//折线点的颜色
                                    lineStyle: {
                                        color: randomColor(),//折线的颜色
                                        width: 2,
                                    }
                                },
                            }
                        },
                    ]
                };
                //获取dom容器
                var myChart = echarts.init(document.getElementById('chartmain_zhe'));
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
                //};

            }
        });
    }


    {#$(".shu1").numScroll();#}
    {#$(".shu2").numScroll();#}
    {#$(".shu3").numScroll();#}
    {#$(".shu4").numScroll();#}
    {#$(".shu5").numScroll();#}
    {#$(".shu6").numScroll();#}

    /*$(".num2").numScroll({
        time:5000
    });*/
</script>

</body>
</html>
